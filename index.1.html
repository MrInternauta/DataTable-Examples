<!DOCTYPE html>
<html>


<head>
    <meta charset="utf-8">
    <title>Curso Datattables</title>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <style>
        .highlight {
            color: lightgreen;
            background: black;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="col-md-12">
            <h1>Ejemplos Datatables</h1>


            <table class="table" id="EmployeesTable">
                <thead>
                    <tr>
                        <th>Id</th>
                        <th>Nombre</th>
                        <th>Pais</th>
                        <th>Edad</th>
                    </tr>
                </thead>
                <tfoot>
                    <tr>
                        <th>Id</th>
                        <th>Nombre</th>
                        <th>Pais</th>
                        <th>Edad</th>
                    </tr>
                </tfoot>
            </table>

            <hr>

            <table class="table" id="UsersTable">
                <thead>
                    <tr>
                        <th>Id</th>
                        <th>Nombre</th>
                        <th>Email</th>
                    </tr>
                </thead>
            </table>

            <hr>

            <table class="table" id="ProductsTable">
                <thead>
                    <tr>
                        <th>Id</th>
                        <th>Nombre</th>
                        <th>Precio</th>
                    </tr>
                </thead>
                <tfoot>
                    <tr>
                        <th colspan="3" style="text-align:right">Total:</th>
                    </tr>
                </tfoot>
            </table>


        </div>
    </div>



    <script src="https://code.jquery.com/jquery-3.3.1.js" integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.js"></script>


    <script>
        var users = [{
            "id": 1,
            "name": "Opaline",
            "email": "ocaress0@tripod.com"
        }, {
            "id": 2,
            "name": "Byrle",
            "email": "byushkov1@un.org"
        }, {
            "id": 3,
            "name": "Saxon",
            "email": "scrier2@scribd.com"
        }, {
            "id": 4,
            "name": "Shelden",
            "email": "skelloch3@chronoengine.com"
        }, {
            "id": 5,
            "name": "Wilone",
            "email": "wnannoni4@rediff.com"
        }, {
            "id": 6,
            "name": "Oralle",
            "email": "olergan5@bing.com"
        }, {
            "id": 7,
            "name": "Hewitt",
            "email": "heat6@sogou.com"
        }, {
            "id": 8,
            "name": "Pia",
            "email": "plyst7@stanford.edu"
        }, {
            "id": 9,
            "name": "Donna",
            "email": "dscambler8@china.com.cn"
        }, {
            "id": 10,
            "name": "Etan",
            "email": "estoak9@unc.edu"
        }];

        jQuery(document).ready(function($) {
            //Extender  a todas las Databales de esta pagina 
            $.extend(true, $.fn.DataTable.defaults, {
                // Herramientas
                info: true,
                paging: true,
                ordering: true,
                searching: true,
                scrollY: '40vh',
                language: {
                    url: "https://cdn.datatables.net/plug-ins/1.10.19/i18n/Spanish.json"
                },
                lengthMenu: [
                    [10, 20, 50, 100, 200, 500, -1],
                    ['10', '20', '50', '100', '200', '500', 'Todos']
                ]
            });

            $('#UsersTable').DataTable({

                // ajax: {
                //     url: "http://localhost:8080/DataTable-Examples/users.json"
                // },
                // OBTIENE DESDE UN ARRAY
                data: users,
                columns: [{
                    name: "id",
                    data: "id"
                }, {
                    name: "name",
                    data: "name"
                }, {
                    name: "email",
                    data: "email",
                    //Herramientas por columna
                    visible: true,
                    searchable: false,
                    render: function(data, type, row) {
                        return `(${row.id}) ${data} `
                    }
                }],

                // ordenar
                columnDefs: [{
                    target: [0],
                    orderData: [0, 1]
                }, {
                    target: [1],
                    orderData: [1, 2]
                }, {
                    target: [2],
                    orderData: [0, 1, 2]
                }],


            });


            $('#ProductsTable').DataTable({
                stateSave: true,
                paging: false,
                ajax: {
                    url: "http://localhost:8080/DataTable-Examples/products.json"
                },
                columns: [{
                    name: "id",
                    data: "id"
                }, {
                    name: "name",
                    data: "name"
                }, {
                    name: "price",
                    data: "price"
                }],
                //Calcular el total del precio
                footerCallback: function(row, data, start, end, display) {
                    //calcular total
                    var api = this.api();
                    var intVal = function(i) {
                        return typeof i === 'string' ?
                            i.replace(/[\$]/g, '').replace(/,/g, '.') * 1 :
                            typeof i === 'number' ?
                            i : 0;
                    };
                    var total = api.column(2).data().reduce(function(a, b) {
                        return intVal(a) + intVal(b);
                    }, 0);
                    var totalpage = api.column(2, {
                        page: 'current'
                    }).data().reduce(function(a, b) {
                        return intVal(a) + intVal(b);
                    }, 0);
                    $(api.column(2).footer()).html(
                        '€' + totalpage.toFixed(2) + "(€" + total.toFixed(2) + ")"
                    )
                },
                // Marcar una columna cuando cumpla una condicion
                createdRow: function(row, data, index) {
                    if (data.price.replace(/[\$]/g, '').replace(/,/g, '.') * 1 > 5) {
                        //accede a la segunda columna
                        $("td", row).eq(2).addClass('highlight');
                    }
                }

            });
            $('#EmployeesTable').DataTable({
                order: [
                    [2, 'asc']
                ],
                ajax: {
                    url: "http://localhost:8080/DataTable-Examples/employes.json"
                },
                columns: [{
                    name: "id",
                    data: "id"
                }, {
                    name: "name",
                    data: "name"
                }, {
                    name: "country",
                    data: "country",
                    visible: false
                }, {
                    name: "age",
                    data: "age",
                }],
                //"Agrupa por pais"
                drawCallback: function(setting) {
                    var api = this.api();
                    //accede a todas las filas
                    var rows = api.rows({
                        page: 'current'
                    }).nodes();
                    var last = null;
                    api.column(2, {
                        page: 'current'
                    }).data().each(function(group, i) {
                        if (last !== group) {
                            $(rows).eq(i).before(
                                `<tr class="highlight"><td colspan="4">${group}</td> </tr>`
                            );
                            last = group;
                        }
                    })
                },
                //Buscar por click al elemento
                initComplete: function() {
                    var api = this.api();
                    api.$('td').click(function() {
                        api.search(this.innerHTML).draw();
                    })
                }


            });



        });
    </script>
</body>

</html>